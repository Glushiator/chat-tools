<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Matcher</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            gap: 15px;
        }
        .container {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        h2 { margin-top: 0; }
        input[type="text"] {
            padding: 8px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            border: 1px solid #007bff;
            background-color: #007bff;
            color: white;
        }
        #status {
            font-weight: bold;
            font-size: 1.1em;
            color: #333;
            min-height: 25px;
        }
        #savedList {
            list-style-type: none;
            padding: 0;
            text-align: left;
            font-family: monospace;
        }
        #savedList li {
            background-color: #f0f0f0;
            margin-bottom: 5px;
            padding: 8px;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>Current Status</h2>
        <div id="status">Initializing...</div>
    </div>

    <div class="container">
        <h2>Save New Location</h2>
        <input type="text" id="locationLabel" placeholder="Enter label (e.g., Office)">
        <button id="saveButton">Save Current Location</button>
    </div>

    <div class="container">
        <h2>Saved Locations</h2>
        <ul id="savedList"></ul>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const statusDiv = document.getElementById('status');
    const saveButton = document.getElementById('saveButton');
    const locationLabelInput = document.getElementById('locationLabel');
    const savedList = document.getElementById('savedList');

    const STORAGE_KEY = 'savedLocations';

    // --- Core Functions ---

    /**
     * Calculates distance between two coordinates in meters using the Haversine formula.
     */
    function calculateDistance(lat1, lon1, lat2, lon2) {
        const R = 6371e3; // Earth's radius in meters
        const phi1 = lat1 * Math.PI / 180;
        const phi2 = lat2 * Math.PI / 180;
        const deltaPhi = (lat2 - lat1) * Math.PI / 180;
        const deltaLambda = (lon2 - lon1) * Math.PI / 180;

        const a = Math.sin(deltaPhi / 2) * Math.sin(deltaPhi / 2) +
                  Math.cos(phi1) * Math.cos(phi2) *
                  Math.sin(deltaLambda / 2) * Math.sin(deltaLambda / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

        return R * c; // Distance in meters
    }

    /**
     * Loads locations from localStorage.
     */
    function getSavedLocations() {
        return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    }

    /**
     * Displays all saved locations in the list.
     */
    function displaySavedLocations() {
        const locations = getSavedLocations();
        savedList.innerHTML = ''; // Clear current list
        if (locations.length === 0) {
            savedList.innerHTML = '<li>No locations saved yet.</li>';
            return;
        }
        locations.forEach(loc => {
            const li = document.createElement('li');
            li.textContent = `${loc.label}: (${loc.coords.lat.toFixed(4)}, ${loc.coords.lon.toFixed(4)})`;
            savedList.appendChild(li);
        });
    }

    /**
     * On page load, get current location and check against saved locations.
     */
    function checkCurrentLocation() {
        statusDiv.textContent = 'Getting your current location...';
        if (!navigator.geolocation) {
            statusDiv.textContent = "Geolocation is not supported by your browser.";
            return;
        }
        navigator.geolocation.getCurrentPosition(position => {
            const currentCoords = {
                lat: position.coords.latitude,
                lon: position.coords.longitude
            };
            const savedLocations = getSavedLocations();
            let matchFound = false;

            for (const loc of savedLocations) {
                const distance = calculateDistance(currentCoords.lat, currentCoords.lon, loc.coords.lat, loc.coords.lon);
                if (distance <= 100) { // Check if within 100 meters
                    statusDiv.textContent = `You are at: ${loc.label}`;
                    matchFound = true;
                    break;
                }
            }

            if (!matchFound) {
                statusDiv.textContent = 'You are not at any saved location.';
            }

        }, () => {
            statusDiv.textContent = 'Unable to retrieve your location.';
        });
    }


    // --- Event Listeners ---

    saveButton.addEventListener('click', () => {
        const label = locationLabelInput.value.trim();
        if (!label) {
            alert('Please enter a label for the location.');
            return;
        }

        navigator.geolocation.getCurrentPosition(position => {
            const newLocation = {
                label: label,
                coords: {
                    lat: position.coords.latitude,
                    lon: position.coords.longitude
                }
            };

            const locations = getSavedLocations();
            locations.push(newLocation);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(locations));
            
            alert(`Location "${label}" saved!`);
            locationLabelInput.value = ''; // Clear input field
            displaySavedLocations(); // Refresh the list
        }, () => {
            alert('Could not get your location to save it.');
        });
    });


    // --- Initial Load ---
    displaySavedLocations();
    checkCurrentLocation();
});
</script>

</body>
</html>
